---
title: 现代操作系统
tags:
    - 操作系统
    - 笔记
---

## 引论
用户与之交互的程序，基于文本的通常称为shell，基于图标的通常称为GUI（图形用户界面）

多数计算机有两种运行模式：内核态和用户态
操作系统运行在内核态，在这个模式中，操作系统具有对所有硬件的完全访问权，可以执行机器能运行的任何指令。  
其他软件运行在用户态，在用户态下，只使用了机器指令中的一个子集。特别的，那些会影响机器的控制或可进行I/O操作的指令，在用户态时禁止的。

#### 操作系统
操作系统运行在裸机之上，为所有其他软件提供基础的运行环境。

操作系统又两个基本上独立的任务：
- 为应用程序提供一个资源集的清晰抽象
- 管理硬件资源

所有的操作系统都提供使用硬盘的又一层抽象：文件。

抽象时管理复杂性的一个关键。好的抽象可以把一个几乎不可能管理的任务划分为两个可管理的部分：
- 有关抽象的定义和实现
- 随时使用这些抽象解决问题

操作系统的任务时创建好的抽象，并实现和管理它所创建的抽象对象。

多道程序运行，操作系统的主要任务时记录哪个程序在使用什么资源，对资源请求进行分配，评估使用代价，并且为不同的程序和用户调解互相冲突的资源请求。

有两种方式实现多路复用（共享）资源：
- 在时间上复用：不同的运行程序轮流使用
- 在空间上复用：每个运行程序都得到资源的一部分，从而取代了排队

#### 计算机硬件
CPU：计算机的大脑，从内存中取出指令并执行之。在每个CPU基本周期中，从内存中取出指令，解码以确定其类型和操作书，接着执行之，并重复这一步骤。

存储器：分层存储结构  
只要存在大量的资源可以划分为小的部分，那么，这些资源中的某些部分就会比其他部分更频繁地得到使用，通常缓存的使用会带来性能上的改善。  
缓存需要考虑的问题：
- 何时把一个新的内容放入缓存
- 把新内容放在缓存的哪一行上
- 在需要时，应该把哪个内容从缓存中移走
- 应该把新移走的内容放在某个较大存储器的何处

I/O设备包括两个部分：
- 设备控制器：是插在电路板上的一块芯片或一组芯片，物理地控制设备
- 设备：设备本身有个相对简单的接口，简单是因为接口既不能做很多工作，又已经被标准化了

#### 进程
进程本质上正在执行的一个程序。基本上是容纳运行一个程序所需要所有信息的容器。

#### 文件
操作系统的一项主要功能是隐藏磁盘和其他I/O设备的细节特征，提供给程序员一个良好，清晰的独立于设备的抽象文件模型。

UNIX中有个重要概念是特殊文件，提供特殊文件是为了使I/O设备看起来像文件一样被操作。

管道是一种虚文件，可连接两个进程。这样，在UNIX中两个进程之间的通信就类似于普通文件的读写了。

#### 操作系统结构
单体系统
- 需要一个主程序，用来处理服务过程请求
- 需要一套服务过程，用来执行系统调用
- 需要一套实用过程，用来辅助服务过程

层次式系统：将单体系统进一步通用化，上层软件都是在下一层软件的基础上构建的。

微内核：为了实现高可靠性，将操作系统划分成小的，良好定义的模块。
只有其中一个模块运行在内核态，其余的模块由于功能相对弱些，则作为普通用户进程运行。

内核中的机制与策略分离原则：
- 机制（在内核中）就是寻找最高优先级的进程并运行之
- 策略（赋予进程优先级）可以有用户态中的进程完成

## 进程与线程
#### 进程
在进程模型中，计算机上所有可运行的软件，通常也包括操作系统，被组织成若干顺序进程。
一个进程就是一个正在执行程序的实例，包括程序计数器，寄存器和变量的当前值。

一个类型是某种类型的一个活动，它有程序，输入，输出以及状态。
单个处理器可以被若干进程共享，它使用某种调度算法决定何时停止一个进程的工作，并转而为另一个进程提供服务。

值得注意的是，如果一个程序运行了两遍，则算作两个进程。像“两个进程恰好运行同一个程序”这样的事实其实无关紧要，因为它们是不同的进程。
操作系统能够使它们共享代码，因此只有一个副本放在内存中，但那只是一个技术性的细节。