---
title: 现代操作系统
tags:
    - 操作系统
    - 笔记
---

## 引论
用户与之交互的程序，基于文本的通常称为shell，基于图标的通常称为GUI（图形用户界面）

多数计算机有两种运行模式：内核态和用户态
操作系统运行在内核态，在这个模式中，操作系统具有对所有硬件的完全访问权，可以执行机器能运行的任何指令。  
其他软件运行在用户态，在用户态下，只使用了机器指令中的一个子集。特别的，那些会影响机器的控制或可进行I/O操作的指令，在用户态时禁止的。

#### 操作系统
操作系统运行在裸机之上，为所有其他软件提供基础的运行环境。

操作系统又两个基本上独立的任务：
- 为应用程序提供一个资源集的清晰抽象
- 管理硬件资源

所有的操作系统都提供使用硬盘的又一层抽象：文件。

抽象时管理复杂性的一个关键。好的抽象可以把一个几乎不可能管理的任务划分为两个可管理的部分：
- 有关抽象的定义和实现
- 随时使用这些抽象解决问题

操作系统的任务时创建好的抽象，并实现和管理它所创建的抽象对象。

多道程序运行，操作系统的主要任务时记录哪个程序在使用什么资源，对资源请求进行分配，评估使用代价，并且为不同的程序和用户调解互相冲突的资源请求。

有两种方式实现多路复用（共享）资源：
- 在时间上复用：不同的运行程序轮流使用
- 在空间上复用：每个运行程序都得到资源的一部分，从而取代了排队

#### 计算机硬件
CPU：计算机的大脑，从内存中取出指令并执行之。在每个CPU基本周期中，从内存中取出指令，解码以确定其类型和操作书，接着执行之，并重复这一步骤。

存储器：分层存储结构  
只要存在大量的资源可以划分为小的部分，那么，这些资源中的某些部分就会比其他部分更频繁地得到使用，通常缓存的使用会带来性能上的改善。  
缓存需要考虑的问题：
- 何时把一个新的内容放入缓存
- 把新内容放在缓存的哪一行上
- 在需要时，应该把哪个内容从缓存中移走
- 应该把新移走的内容放在某个较大存储器的何处

I/O设备包括两个部分：
- 设备控制器：是插在电路板上的一块芯片或一组芯片，物理地控制设备
- 设备：设备本身有个相对简单的接口，简单是因为接口既不能做很多工作，又已经被标准化了

#### 进程
进程本质上正在执行的一个程序。基本上是容纳运行一个程序所需要所有信息的容器。

#### 文件
操作系统的一项主要功能是隐藏磁盘和其他I/O设备的细节特征，提供给程序员一个良好，清晰的独立于设备的抽象文件模型。

UNIX中有个重要概念是特殊文件，提供特殊文件是为了使I/O设备看起来像文件一样被操作。

管道是一种虚文件，可连接两个进程。这样，在UNIX中两个进程之间的通信就类似于普通文件的读写了。

#### 操作系统结构
单体系统
- 需要一个主程序，用来处理服务过程请求
- 需要一套服务过程，用来执行系统调用
- 需要一套实用过程，用来辅助服务过程

层次式系统：将单体系统进一步通用化，上层软件都是在下一层软件的基础上构建的。

微内核：为了实现高可靠性，将操作系统划分成小的，良好定义的模块。
只有其中一个模块运行在内核态，其余的模块由于功能相对弱些，则作为普通用户进程运行。

内核中的机制与策略分离原则：
- 机制（在内核中）就是寻找最高优先级的进程并运行之
- 策略（赋予进程优先级）可以有用户态中的进程完成

## 进程与线程
#### 进程
在进程模型中，计算机上所有可运行的软件，通常也包括操作系统，被组织成若干顺序进程。
一个进程就是一个正在执行程序的实例，包括程序计数器，寄存器和变量的当前值。

一个类型是某种类型的一个活动，它有程序，输入，输出以及状态。
单个处理器可以被若干进程共享，它使用某种调度算法决定何时停止一个进程的工作，并转而为另一个进程提供服务。

值得注意的是，如果一个程序运行了两遍，则算作两个进程。像“两个进程恰好运行同一个程序”这样的事实其实无关紧要，因为它们是不同的进程。
操作系统能够使它们共享代码，因此只有一个副本放在内存中，但那只是一个技术性的细节。

#### 线程
为什么需要线程：
- 在应用中同时发生着多种活动，其中某些活动随着时间的推移会被阻塞，通过将这些应用程序分解为可以准并行运行的多个顺序线程，程序设计模型会变得更简单。并行实体拥有共享同一个地址空间和所有可用数据的能力。
- 线程比进程更轻量级
- 如果存在大量的计算和大量的I/O处理，拥有多个线程允许这些活动彼此重叠进行

一种组织Web服务器的方式：
一个称为分派程序的线程从网络中读入工作请求，在检查请求后，分派线程挑选一个

进程模型基于两种独立的概念：资源分组处理与执行

线程概念试图实现的是，共享一组资源的多个线程的执行能力，以便这些线程可以为完成某一任务而共同工作。

#### 进程间通信
有三个问题：
- 一个进程如何把信息传递给另一个
- 确保多个进程在关键活动中不会出现交叉
- 进程的顺序

协作的进程可能共享一些彼此都能读写的公用存储区

竞争条件：多个进程读写某些共享数据，而最后的结果取决于进程运行的精确时序。

互斥：以某种手段确保当一个进程在使用一个共享变量或文件时，其他进程不能做同样的操作。

避免竞争的四个条件：
- 任何两个进程不能同时处于其临界区
- 不应对CPU的速度和数量做任何假设
- 临界区外运行的进程不得阻塞其他进程
- 不得使进程无限期等待进入临界区

#### 管程
一种高级同步语言，一个管程是一个由过程，变量及数据结构等组成的一个集合，它们组成一个特殊的模块或软件包。

进程可在任何需要的时候调用管程中的过程，但它们不能直接访问管程中的数据结构。

管程有一个很重要的特性，任一时刻管程中只能有一个活跃进程，这一特性使管程能有效的完成互斥。

#### 调度
几乎所有进程的（磁盘/网络）I/O请求和计算都是交替突发的。

当一个进程等待外部设备完成工作而被阻塞时，才是I/O请求。

何时调度：
- 在创建一个新进程之后，需要决定是运行父进程还是子进程
- 在一个进程退出时必须做出调度决策
- 当一个进程阻塞在I/O和信号量上或由于其他原因阻塞时，选择另一个进程
- 在一个I/O中断发生时，做出调度决策

实时系统只运行那些用来推进现有应用的程序，而交互式系统是通用的，它可以运行任意的非协作甚至是有恶意的程序。

调度算法：
- 先来先服务
- 最短作业优先
- 最短剩余时间优先
- 轮转调度

## 文件系统
操作系统提取处理器的概念来建立进程的抽象，提取物理存储器的概念来建立进程（虚拟）地址空间的抽象。
文件是进程创建的信息逻辑单位。文件是对磁盘的建模，把每个文件看成一个地址空间。

#### 文件
文件是一种抽象机制，提供了一种在磁盘上保存信息而且方便以后读取的方法。
也许任何一种抽象机制的最重要特性就是对管理对象的命名方式。 

普通文件一般分为SSCII文件和二进制文件。
目录是管理文件系统结构的系统文件。


